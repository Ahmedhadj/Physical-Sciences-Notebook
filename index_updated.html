<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2942/2942076.png">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¯ÙØªØ± Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ø£Ø³ØªØ§Ø° - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„ØµØ­ÙŠØ­</title>

    <!-- Google Fonts & Font Awesome -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.0/css/all.min.css">

    <!-- External JS Libraries for Attendance System -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js">
// === EXPORT & IMPORT ALL DATA ===
function exportAllData() {
    const allData = {
        students: JSON.parse(localStorage.getItem('students')) || [],
        dailyNotes: JSON.parse(localStorage.getItem('dailyNotes')) || [],
        grading: JSON.parse(localStorage.getItem('grading')) || [],
        diary: JSON.parse(localStorage.getItem('diary')) || [],
        seating: JSON.parse(localStorage.getItem('seating')) || [],
        teachers: JSON.parse(localStorage.getItem('teachers')) || [],
        attendance: JSON.parse(localStorage.getItem('attendance')) || {}
    };
    const blob = new Blob([JSON.stringify(allData, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "notebook-data.json";
    a.click();
    URL.revokeObjectURL(url);
    document.getElementById("data-status").textContent = "âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­";
    document.getElementById("data-status").className = "status-message success";
}

function importAllData() {
    const fileInput = document.getElementById("import-json");
    const file = fileInput.files[0];
    if (!file) {
        document.getElementById("data-status").textContent = "âš ï¸ Ø§Ø®ØªØ± Ù…Ù„Ù JSON Ø£ÙˆÙ„Ø§";
        document.getElementById("data-status").className = "status-message error";
        return;
    }
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const data = JSON.parse(e.target.result);
            if (data.students) localStorage.setItem("students", JSON.stringify(data.students));
            if (data.dailyNotes) localStorage.setItem("dailyNotes", JSON.stringify(data.dailyNotes));
            if (data.grading) localStorage.setItem("grading", JSON.stringify(data.grading));
            if (data.diary) localStorage.setItem("diary", JSON.stringify(data.diary));
            if (data.seating) localStorage.setItem("seating", JSON.stringify(data.seating));
            if (data.teachers) localStorage.setItem("teachers", JSON.stringify(data.teachers));
            if (data.attendance) localStorage.setItem("attendance", JSON.stringify(data.attendance));
            document.getElementById("data-status").textContent = "âœ… ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„Ø¹Ø±Ø¶Ù‡Ø§.";
            document.getElementById("data-status").className = "status-message success";
        } catch (err) {
            document.getElementById("data-status").textContent = "âŒ Ø®Ø·Ø£: Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­";
            document.getElementById("data-status").className = "status-message error";
        }
    };
    reader.readAsText(file);
}

</script>
    <script src="https://unpkg.com/papaparse@5.3.2/papaparse.min.js">
// === EXPORT & IMPORT ALL DATA ===
function exportAllData() {
    const allData = {
        students: JSON.parse(localStorage.getItem('students')) || [],
        dailyNotes: JSON.parse(localStorage.getItem('dailyNotes')) || [],
        grading: JSON.parse(localStorage.getItem('grading')) || [],
        diary: JSON.parse(localStorage.getItem('diary')) || [],
        seating: JSON.parse(localStorage.getItem('seating')) || [],
        teachers: JSON.parse(localStorage.getItem('teachers')) || [],
        attendance: JSON.parse(localStorage.getItem('attendance')) || {}
    };
    const blob = new Blob([JSON.stringify(allData, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "notebook-data.json";
    a.click();
    URL.revokeObjectURL(url);
    document.getElementById("data-status").textContent = "âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­";
    document.getElementById("data-status").className = "status-message success";
}

function importAllData() {
    const fileInput = document.getElementById("import-json");
    const file = fileInput.files[0];
    if (!file) {
        document.getElementById("data-status").textContent = "âš ï¸ Ø§Ø®ØªØ± Ù…Ù„Ù JSON Ø£ÙˆÙ„Ø§";
        document.getElementById("data-status").className = "status-message error";
        return;
    }
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const data = JSON.parse(e.target.result);
            if (data.students) localStorage.setItem("students", JSON.stringify(data.students));
            if (data.dailyNotes) localStorage.setItem("dailyNotes", JSON.stringify(data.dailyNotes));
            if (data.grading) localStorage.setItem("grading", JSON.stringify(data.grading));
            if (data.diary) localStorage.setItem("diary", JSON.stringify(data.diary));
            if (data.seating) localStorage.setItem("seating", JSON.stringify(data.seating));
            if (data.teachers) localStorage.setItem("teachers", JSON.stringify(data.teachers));
            if (data.attendance) localStorage.setItem("attendance", JSON.stringify(data.attendance));
            document.getElementById("data-status").textContent = "âœ… ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„Ø¹Ø±Ø¶Ù‡Ø§.";
            document.getElementById("data-status").className = "status-message success";
        } catch (err) {
            document.getElementById("data-status").textContent = "âŒ Ø®Ø·Ø£: Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­";
            document.getElementById("data-status").className = "status-message error";
        }
    };
    reader.readAsText(file);
}

</script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js">
// === EXPORT & IMPORT ALL DATA ===
function exportAllData() {
    const allData = {
        students: JSON.parse(localStorage.getItem('students')) || [],
        dailyNotes: JSON.parse(localStorage.getItem('dailyNotes')) || [],
        grading: JSON.parse(localStorage.getItem('grading')) || [],
        diary: JSON.parse(localStorage.getItem('diary')) || [],
        seating: JSON.parse(localStorage.getItem('seating')) || [],
        teachers: JSON.parse(localStorage.getItem('teachers')) || [],
        attendance: JSON.parse(localStorage.getItem('attendance')) || {}
    };
    const blob = new Blob([JSON.stringify(allData, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "notebook-data.json";
    a.click();
    URL.revokeObjectURL(url);
    document.getElementById("data-status").textContent = "âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­";
    document.getElementById("data-status").className = "status-message success";
}

function importAllData() {
    const fileInput = document.getElementById("import-json");
    const file = fileInput.files[0];
    if (!file) {
        document.getElementById("data-status").textContent = "âš ï¸ Ø§Ø®ØªØ± Ù…Ù„Ù JSON Ø£ÙˆÙ„Ø§";
        document.getElementById("data-status").className = "status-message error";
        return;
    }
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const data = JSON.parse(e.target.result);
            if (data.students) localStorage.setItem("students", JSON.stringify(data.students));
            if (data.dailyNotes) localStorage.setItem("dailyNotes", JSON.stringify(data.dailyNotes));
            if (data.grading) localStorage.setItem("grading", JSON.stringify(data.grading));
            if (data.diary) localStorage.setItem("diary", JSON.stringify(data.diary));
            if (data.seating) localStorage.setItem("seating", JSON.stringify(data.seating));
            if (data.teachers) localStorage.setItem("teachers", JSON.stringify(data.teachers));
            if (data.attendance) localStorage.setItem("attendance", JSON.stringify(data.attendance));
            document.getElementById("data-status").textContent = "âœ… ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„Ø¹Ø±Ø¶Ù‡Ø§.";
            document.getElementById("data-status").className = "status-message success";
        } catch (err) {
            document.getElementById("data-status").textContent = "âŒ Ø®Ø·Ø£: Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­";
            document.getElementById("data-status").className = "status-message error";
        }
    };
    reader.readAsText(file);
}

</script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js">
// === EXPORT & IMPORT ALL DATA ===
function exportAllData() {
    const allData = {
        students: JSON.parse(localStorage.getItem('students')) || [],
        dailyNotes: JSON.parse(localStorage.getItem('dailyNotes')) || [],
        grading: JSON.parse(localStorage.getItem('grading')) || [],
        diary: JSON.parse(localStorage.getItem('diary')) || [],
        seating: JSON.parse(localStorage.getItem('seating')) || [],
        teachers: JSON.parse(localStorage.getItem('teachers')) || [],
        attendance: JSON.parse(localStorage.getItem('attendance')) || {}
    };
    const blob = new Blob([JSON.stringify(allData, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "notebook-data.json";
    a.click();
    URL.revokeObjectURL(url);
    document.getElementById("data-status").textContent = "âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­";
    document.getElementById("data-status").className = "status-message success";
}

function importAllData() {
    const fileInput = document.getElementById("import-json");
    const file = fileInput.files[0];
    if (!file) {
        document.getElementById("data-status").textContent = "âš ï¸ Ø§Ø®ØªØ± Ù…Ù„Ù JSON Ø£ÙˆÙ„Ø§";
        document.getElementById("data-status").className = "status-message error";
        return;
    }
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const data = JSON.parse(e.target.result);
            if (data.students) localStorage.setItem("students", JSON.stringify(data.students));
            if (data.dailyNotes) localStorage.setItem("dailyNotes", JSON.stringify(data.dailyNotes));
            if (data.grading) localStorage.setItem("grading", JSON.stringify(data.grading));
            if (data.diary) localStorage.setItem("diary", JSON.stringify(data.diary));
            if (data.seating) localStorage.setItem("seating", JSON.stringify(data.seating));
            if (data.teachers) localStorage.setItem("teachers", JSON.stringify(data.teachers));
            if (data.attendance) localStorage.setItem("attendance", JSON.stringify(data.attendance));
            document.getElementById("data-status").textContent = "âœ… ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„Ø¹Ø±Ø¶Ù‡Ø§.";
            document.getElementById("data-status").className = "status-message success";
        } catch (err) {
            document.getElementById("data-status").textContent = "âŒ Ø®Ø·Ø£: Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­";
            document.getElementById("data-status").className = "status-message error";
        }
    };
    reader.readAsText(file);
}

</script>

    <style>
        :root {
            --primary-color: #2980b9; --secondary-color: #3498db; --header-bg: #ecf0f1;
            --border-color: #bdc3c7; --text-color: #34495e; --sidebar-bg: #2c3e50;
            --sidebar-hover: #34495e; --sidebar-active: #1abc9c; --danger-color: #c0392b;
            --success-bg: #d4edda; --success-color: #155724; --error-bg: #f8d7da;
            --error-color: #721c24; --info-bg: #d1ecf1; --info-color: #0c5460;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Cairo', sans-serif; margin: 0; background-color: #f0f2f5; color: var(--text-color); }
        .container { display: flex; }
        .sidebar { width: 280px; background-color: var(--sidebar-bg); color: white; padding: 20px; height: 100vh; position: fixed; overflow-y: auto; }
        .sidebar h2 { text-align: center; color: #ecf0f1; margin-bottom: 30px; }
        .sidebar ul { list-style-type: none; padding: 0; }
        .sidebar ul li { padding: 15px 20px; cursor: pointer; transition: background-color 0.3s; border-right: 4px solid transparent; border-radius: 5px 0 0 5px; margin-bottom: 5px;}
        .sidebar ul li:hover, .sidebar ul li.active { background-color: var(--sidebar-hover); border-right-color: var(--sidebar-active); }
        .main-content { margin-right: 300px; padding: 25px; width: calc(100% - 300px); }
        .content-section { display: none; background-color: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .content-section.active { display: block; }
        .section-title { background: linear-gradient(to left, var(--primary-color), var(--secondary-color)); color: white; padding: 10px 20px; border-radius: 8px; text-align: center; font-size: 1.8em; margin: 0 0 30px 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 1em; }
        th, td { border: 1px solid var(--border-color); padding: 10px; text-align: center; vertical-align: middle; }
        th { background-color: var(--header-bg); font-weight: 700; }
        .notebook-input, .notebook-textarea { width: 100%; padding: 8px; border: none; background: transparent; font-family: inherit; font-size: 1em; box-sizing: border-box; }
        .notebook-textarea { resize: vertical; min-height: 80px; }
        .teacher-card-info p { font-size: 1.2em; padding: 10px 0; border-bottom: 1px dotted var(--border-color); display: flex; align-items: center; }
        .teacher-card-info strong { display: inline-block; width: 200px; flex-shrink: 0; }
        .table-actions { text-align: left; margin-top: 15px; }
        .btn-add-row, .btn-add-seat { background-color: var(--primary-color); color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-family: inherit; font-size: 0.9em; transition: background-color 0.3s; }
        .btn-add-row:hover, .btn-add-seat:hover { background-color: var(--secondary-color); }
        .btn-delete-row { background: none; border: none; color: var(--danger-color); cursor: pointer; font-size: 1.2em; }
        td.actions-cell { width: 60px; }
        .seating-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; }
        .seat { border: 1px solid #ccc; border-radius: 5px; padding: 5px; position: relative; }
        .seat .notebook-input { text-align: center; }
        .btn-delete-seat { position: absolute; top: -5px; left: -5px; background-color: var(--danger-color); color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px; line-height: 20px; text-align: center; }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 1em; transition: all 0.3s ease; margin: 5px; display: inline-flex; align-items: center; gap: 8px; vertical-align: middle; } .btn-add { background-color: #28a745; color: white; } .btn-report { background-color: #ffc107; color: #333; } .btn-secondary { background-color: #6c757d; color: white; } .btn-export { background-color: #17a2b8; color: white; } .btn-action { background-color: var(--secondary-color); color: white; font-size: 0.85em; padding: 4px 10px; } .btn-scan { background-color: #6f42c1; color: white; } .btn-stop-scan { background-color: #dc3545; color: white; } .btn-small { padding: 6px 12px; font-size: 0.9em; } .btn-delete { background-color: #dc3545; color: white; font-size: 0.85em; padding: 4px 10px; }
        #attendance-system .form-section { background-color: #fdfdfd; padding: 25px; border-radius: 5px; margin-bottom: 25px; border: 1px solid #ddd; }
        #attendance-system h2 { border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; margin-top: 30px; font-size: 1.5em; display: flex; align-items: center; gap: 10px; color: var(--primary-color); }
        #attendance-system .table-container { max-height: 450px; overflow: auto; border: 1px solid #ddd; background-color: #fff; margin-bottom: 20px; border-radius: 5px; }
        #attendance-system table thead th { background-color: var(--primary-color); color: white; position: sticky; top: 0; z-index: 10; }
        #attendance-system table tbody tr:nth-child(even) { background-color: #f8f9fa; }
        #qr-scanner-section { margin-top: 20px; padding: 20px; border: 1px solid #ccc; border-radius: 5px; background-color: #f8f9fa; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); }
        .modal-content { background-color: #fefefe; margin: 15% auto; padding: 25px; border: 1px solid #888; width: 80%; max-width: 350px; border-radius: 8px; text-align: center; position: relative; }
        .close-btn { color: #aaa; position: absolute; left: 15px; top: 10px; font-size: 28px; font-weight: bold; cursor: pointer; }
        #qrcode-container { margin: 20px auto; width: 256px; height: 256px; }
        .view { display: none; } .view.active-view { display: block; }
        .status-message { margin-top: 15px; padding: 12px 15px; border-radius: 5px; text-align: center; border: 1px solid transparent; }
        .status-message.success { background-color: var(--success-bg); color: var(--success-color); border-color: #c3e6cb; }
        .status-message.error { background-color: var(--error-bg); color: var(--error-color); border-color: #f5c6cb; }
        .status-message.info { background-color: var(--info-bg); color: var(--info-color); border-color: #bee5eb; }
        .status-message:empty { display: none; }
        #print-qr-container { display: none; }
        @media print { body > *:not(#print-qr-container) { display: none !important; } #print-qr-container { display: block !important; } .print-page { page-break-after: always; display: grid; grid-template-columns: repeat(2, 1fr); gap: 8mm; padding: 10mm; } .qr-card { border: 1px dashed #999; text-align: center; padding: 10px; } }
    </style>
</head>
<body>
<header style="background:#2980b9;color:white;padding:10px;text-align:center;font-size:1.5em;font-weight:bold;">
ğŸ“˜ Ø§Ù„Ø¯ÙØªØ± Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ø£Ø³ØªØ§Ø°
</header>


<div class="container">
    <div class="sidebar">
        <h2>Ø§Ù„Ø¯ÙØªØ± Ø§Ù„Ø´Ø§Ù…Ù„</h2>
        <ul>
            <li onclick="showSection('welcome-page')" class="active">ğŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</li>
            <li onclick="showSection('teacher-card')">ğŸ’³ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙÙ†ÙŠØ©</li>
            <li onclick="showSection('attendance-system')">âœ… Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</li>
            <li onclick="showSection('school-diary')">ğŸ“… Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©</li>
            <li onclick="showSection('assigned-groups')">ğŸ‘¨â€ğŸ« Ø§Ù„Ø£ÙÙˆØ§Ø¬ ÙˆØ§Ù„ØªÙˆÙ‚ÙŠØª</li>
            <li onclick="showSection('daily-notebook')">ğŸ““ Ø§Ù„Ø¯ÙØªØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</li>
            <li onclick="showSection('grading-book')">ğŸ“Š Ø¯ÙØªØ± Ø§Ù„ØªÙ†Ù‚ÙŠØ·</li>
            <li onclick="showSection('seating-chart')">ğŸª‘ Ù…Ø®Ø·Ø· Ø§Ù„Ø¬Ù„ÙˆØ³</li>
            <li onclick="showSection('annual-distribution')">ğŸ—“ï¸ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø³Ù†ÙˆÙŠ</li>
            <li onclick="showSection('training-days')">ğŸ“ Ø£ÙŠØ§Ù… ØªÙƒÙˆÙŠÙ†ÙŠØ©</li>
            <li onclick="showSection('inspection-visits')">ğŸ” Ø²ÙŠØ§Ø±Ø§Øª ØªÙØªÙŠØ´ÙŠØ©</li>
            <li onclick="showSection('teachers-list')">ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</li>
            <li onclick="showSection('teacher-notepad')">ğŸ“ Ù…ÙÙƒØ±Ø© Ø§Ù„Ø£Ø³ØªØ§Ø°</li>
<li onclick="showSection('data-management')">ğŸ’¾ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</li>
        </ul>
    </div>

    <div class="main-content">
        <!-- Welcome Page -->
        <div id="welcome-page" class="content-section active">
            <h3 class="section-title">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† Ø¯ÙØªØ± Ø§Ù„Ø£Ø³ØªØ§Ø°</h3>
            <p style="text-align: center; font-size: 1.2em;">ÙŠØ¬Ù…Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙØªØ± Ø¨ÙŠÙ† Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ… ÙˆÙ†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¶ÙˆØ±.</p>
        </div>
        
        <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙÙ†ÙŠØ© -->
        <div id="teacher-card" class="content-section">
            <h3 class="section-title">Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙÙ†ÙŠØ© Ù„Ù„Ø£Ø³ØªØ§Ø°(Ø©)</h3>
            <div class="teacher-card-info">
                <p><strong>Ø§Ù„Ø¥Ø³Ù… ÙˆØ§Ù„Ù„Ù‚Ø¨:</strong> <input type="text" class="notebook-input"></p>
                <p><strong>ØªØ§Ø±ÙŠØ® ÙˆÙ…ÙƒØ§Ù† Ø§Ù„Ø§Ø²Ø¯ÙŠØ§Ø¯:</strong> <input type="text" class="notebook-input"></p>
                <p><strong>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠØ©:</strong> <input type="text" class="notebook-input"></p>
                <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> <input type="text" class="notebook-input"></p>
                <p><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</strong> <input type="email" class="notebook-input"></p>
                <p><strong>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</strong> <input type="text" class="notebook-input"></p>
                <hr style="margin: 20px 0; border: 0; border-top: 1px dotted var(--border-color);">
                <p><strong>Ø§Ù„ØªØ®ØµØµ:</strong> <input type="text" class="notebook-input" value="Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©"></p>
                <p><strong>ØªØ§Ø±ÙŠØ® Ø£ÙˆÙ„ ØªØ¹ÙŠÙŠÙ†:</strong> <input type="text" class="notebook-input"></p>
                <p><strong>Ø§Ø³Ù… Ø§Ù„Ù…Ø¤Ø³Ø³Ø©:</strong> <input type="text" class="notebook-input"></p>
            </div>
        </div>

        <!-- Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨ -->
        <div id="attendance-system" class="content-section">
            <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± Ù‡Ù†Ø§ -->
            <div id="management-view" class="view active-view">
                <h3 class="section-title">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</h3>
                <section class="form-section">
                    <h2><i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
                    <form id="add-student-form"><div class="form-grid"><div class="form-group"><label for="first-name">Ø§Ù„Ø§Ø³Ù…:</label><input type="text" id="first-name" required></div><div class="form-group"><label for="last-name">Ø§Ù„Ù„Ù‚Ø¨:</label><input type="text" id="last-name" required></div><div class="form-group"><label for="student-id">Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ:</label><input type="text" id="student-id" required pattern="\d+"></div><div class="form-group"><label for="class-name">Ø§Ù„Ù‚Ø³Ù…:</label><input type="text" id="class-name" required></div></div><button type="submit" class="btn btn-add"><i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨</button></form>
                    <div id="add-student-status" class="status-message"></div>
                </section>
                <section class="form-section">
                    <h2><i class="fas fa-file-import"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
                    <input type="file" id="import-file" accept=".csv, .xlsx, .xls" style="margin-bottom: 10px;"><button id="import-students-btn" class="btn btn-secondary btn-small"><i class="fas fa-upload"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
                    <div id="import-status" class="status-message"></div>
                </section>
                <section>
                    <h2><i class="fas fa-users"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ (<span id="total-students-count">0</span>)</h2>
                    <div class="table-container"><table id="student-table"><thead><tr><th>Ø§Ù„Ø±Ù‚Ù…</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù„Ù‚Ø¨</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody id="student-list-body"></tbody></table></div>
                    <div style="text-align: center; margin-top: 15px;"><button id="export-students-csv-btn" class="btn btn-export btn-small" disabled><i class="fas fa-file-csv"></i> ØªØµØ¯ÙŠØ±</button> <button id="print-qr-cards-btn" class="btn btn-action btn-small" disabled><i class="fas fa-id-card"></i> Ø·Ø¨Ø§Ø¹Ø© Ø¨Ø·Ø§Ù‚Ø§Øª</button></div>
                </section>
                <section id="qr-scanner-section">
                    <h2><i class="fas fa-qrcode"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ø§Ù„Ù…Ø³Ø­</h2>
                    <div style="text-align: center; margin-bottom: 15px;"><button id="start-scan-btn" class="btn btn-scan"><i class="fas fa-camera"></i> Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø­</button><button id="stop-scan-btn" class="btn btn-stop-scan" style="display: none;"><i class="fas fa-stop-circle"></i> Ø¥ÙŠÙ‚Ø§Ù</button></div>
                    <div id="qr-reader" style="display: none; width: 100%; max-width: 500px; margin: auto;"></div>
                    <div id="qr-scan-status" class="status-message info"></div>
                </section>
                <section style="text-align: center; margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;"><button id="go-to-report-btn" class="btn btn-report"><i class="fas fa-chart-line"></i> Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</button></section>
            </div>
            <div id="report-view" class="view">
                 <h3 class="section-title">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
                 <button id="back-to-management-btn" class="btn btn-small btn-secondary" style="position: absolute; top: 35px; left: 35px;"><i class="fas fa-arrow-right"></i> Ø¹ÙˆØ¯Ø©</button>
                 <div class="form-section"><div style="display:flex; align-items:center; gap: 15px; flex-wrap:wrap; margin-bottom: 20px;"><label for="report-date" style="font-weight:bold;">ØªÙ‚Ø±ÙŠØ± Ù„ÙŠÙˆÙ…:</label><input type="date" id="report-date"><button id="refresh-report-btn" class="btn btn-small btn-add"><i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ«</button></div><div style="display:flex; justify-content:space-around; background-color:#e9ecef; padding: 12px; border-radius:4px; font-weight:bold;"><span>Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±: <strong id="attendance-percentage">0%</strong></span> <span>Ø§Ù„Ø­Ø§Ø¶Ø±ÙˆÙ†: <strong id="present-count">0</strong></span> <span>Ø§Ù„ØºØ§Ø¦Ø¨ÙˆÙ†: <strong id="absent-count">0</strong></span></div></div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 25px;"><section><h3><i class="fas fa-user-check"></i> Ø§Ù„Ø­Ø§Ø¶Ø±ÙˆÙ†</h3><div class="table-container"><table id="present-table"><thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø§Ù„ÙˆÙ‚Øª</th></tr></thead><tbody id="present-list-body"></tbody></table></div></section><section><h3><i class="fas fa-user-times"></i> Ø§Ù„ØºØ§Ø¦Ø¨ÙˆÙ†</h3><div class="table-container"><table id="absent-table"><thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‚Ø³Ù…</th></tr></thead><tbody id="absent-list-body"></tbody></table></div></section></div>
                 <div style="text-align: center; margin-top: 25px;"><button id="export-report-csv-btn" class="btn btn-export" disabled><i class="fas fa-file-csv"></i> ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button></div>
            </div>
        </div>
        
        <!-- Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© Ø§Ù„Ø£Ø®Ø±Ù‰ -->
        <div id="school-diary" class="content-section">
            <h3 class="section-title">Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©</h3>
            <table><thead><tr><th>Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th><th class="actions-cell"></th></tr></thead><tbody id="school-diary-tbody"><tr><td><input type="text" class="notebook-input"></td><td><input type="date" class="notebook-input"></td><td><input type="text" class="notebook-input"></td><td><button class="btn-delete-row" onclick="deleteRow(this)">ğŸ—‘ï¸</button></td></tr></tbody></table>
            <div class="table-actions"><button class="btn-add-row" onclick="addRow('school-diary-tbody')">â• Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø«</button></div>
        </div>
        <div id="assigned-groups" class="content-section">
            <h3 class="section-title">Ø§Ù„Ø£ÙÙˆØ§Ø¬ Ø§Ù„Ù…Ø³Ù†Ø¯Ø©</h3>
            <table><thead><tr><th>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th><th>Ø§Ù„ÙÙˆØ¬</th><th>Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°</th><th class="actions-cell"></th></tr></thead><tbody id="groups-tbody"><tr><td><input type="text" class="notebook-input"></td><td><input type="text" class="notebook-input"></td><td><input type="number" class="notebook-input"></td><td><button class="btn-delete-row" onclick="deleteRow(this)">ğŸ—‘ï¸</button></td></tr></tbody></table>
            <div class="table-actions"><button class="btn-add-row" onclick="addRow('groups-tbody')">â• Ø¥Ø¶Ø§ÙØ© ÙÙˆØ¬</button></div>
        </div>
        <div id="daily-notebook" class="content-section">
            <h3 class="section-title">Ø§Ù„Ø¯ÙØªØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
            <table><thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th><th class="actions-cell"></th></tr></thead><tbody id="daily-log-tbody"><tr><td><input type="date" class="notebook-input"></td><td><input type="text" class="notebook-input"></td><td><textarea class="notebook-textarea"></textarea></td><td><textarea class="notebook-textarea"></textarea></td><td><button class="btn-delete-row" onclick="deleteRow(this)">ğŸ—‘ï¸</button></td></tr></tbody></table>
            <div class="table-actions"><button class="btn-add-row" onclick="addRow('daily-log-tbody')">â• Ø¥Ø¶Ø§ÙØ© Ø­ØµØ©</button></div>
        </div>
        <div id="grading-book" class="content-section">
            <h3 class="section-title">Ø¯ÙØªØ± Ø§Ù„ØªÙ†Ù‚ÙŠØ·</h3>
            <table><thead><tr><th>#</th><th>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</th><th>Ø§Ù„ÙØ±Ø¶ 1</th><th>Ø§Ù„ÙØ±Ø¶ 2</th><th>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</th><th>Ø§Ù„Ù…Ø¹Ø¯Ù„</th><th class="actions-cell"></th></tr></thead><tbody id="grading-tbody"><tr><td>01</td><td><input type="text" class="notebook-input"></td><td><input type="number" class="notebook-input"></td><td><input type="number" class="notebook-input"></td><td><input type="number" class="notebook-input"></td><td><input type="text" class="notebook-input" readonly></td><td><button class="btn-delete-row" onclick="deleteRow(this, 'grading-tbody')">ğŸ—‘ï¸</button></td></tr></tbody></table>
            <div class="table-actions"><button class="btn-add-row" onclick="addRow('grading-tbody')">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</button></div>
        </div>
        <div id="seating-chart" class="content-section">
            <h3 class="section-title">Ù…Ø®Ø·Ø· Ø§Ù„Ø¬Ù„ÙˆØ³</h3>
            <div class="seating-grid" id="seating-grid-container"><div class="seat"><input type="text" class="notebook-input"><button class="btn-delete-seat" onclick="deleteSeat(this)">Ã—</button></div></div>
            <div class="table-actions"><button class="btn-add-seat" onclick="addSeat('seating-grid-container')">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø¹Ø¯</button></div>
        </div>
        <div id="annual-distribution" class="content-section">
            <h3 class="section-title">Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø³Ù†ÙˆÙŠ</h3>
            <table><thead><tr><th>Ø§Ù„Ø´Ù‡Ø±</th><th>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</th><th>Ø§Ù„ÙˆØ­Ø¯Ø©</th><th class="actions-cell"></th></tr></thead><tbody id="annual-dist-tbody"><tr><td><input type="text" class="notebook-input"></td><td><input type="text" class="notebook-input"></td><td><textarea class="notebook-textarea"></textarea></td><td><button class="btn-delete-row" onclick="deleteRow(this)">ğŸ—‘ï¸</button></td></tr></tbody></table>
            <div class="table-actions"><button class="btn-add-row" onclick="addRow('annual-dist-tbody')">â• Ø¥Ø¶Ø§ÙØ©</button></div>
        </div>
        <div id="training-days" class="content-section">
            <h3 class="section-title">Ø£ÙŠØ§Ù… ØªÙƒÙˆÙŠÙ†ÙŠØ©</h3>
            <table><thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</th><th class="actions-cell"></th></tr></thead><tbody id="training-tbody"><tr><td><input type="date" class="notebook-input"></td><td><input type="text" class="notebook-input"></td><td><button class="btn-delete-row" onclick="deleteRow(this)">ğŸ—‘ï¸</button></td></tr></tbody></table>
            <div class="table-actions"><button class="btn-add-row" onclick="addRow('training-tbody')">â• Ø¥Ø¶Ø§ÙØ©</button></div>
        </div>
        <div id="inspection-visits" class="content-section">
            <h3 class="section-title">Ø²ÙŠØ§Ø±Ø§Øª ØªÙØªÙŠØ´ÙŠØ©</h3>
            <table><thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø²Ø§Ø¦Ø±</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th><th class="actions-cell"></th></tr></thead><tbody id="inspection-tbody"><tr><td><input type="date" class="notebook-input"></td><td><input type="text" class="notebook-input"></td><td><textarea class="notebook-textarea"></textarea></td><td><button class="btn-delete-row" onclick="deleteRow(this)">ğŸ—‘ï¸</button></td></tr></tbody></table>
            <div class="table-actions"><button class="btn-add-row" onclick="addRow('inspection-tbody')">â• Ø¥Ø¶Ø§ÙØ©</button></div>
        </div>
        <div id="teachers-list" class="content-section">
            <h3 class="section-title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</h3>
            <table><thead><tr><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„Ø£Ø³ØªØ§Ø°</th><th class="actions-cell"></th></tr></thead><tbody id="teachers-tbody"><tr><td><input type="text" class="notebook-input"></td><td><input type="text" class="notebook-input"></td><td><button class="btn-delete-row" onclick="deleteRow(this)">ğŸ—‘ï¸</button></td></tr></tbody></table>
            <div class="table-actions"><button class="btn-add-row" onclick="addRow('teachers-tbody')">â• Ø¥Ø¶Ø§ÙØ©</button></div>
        </div>
        <div id="teacher-notepad" class="content-section">
            <h3 class="section-title">Ù…ÙÙƒØ±Ø© Ø§Ù„Ø£Ø³ØªØ§Ø°</h3>
            <textarea style="width: 100%; height: 500px; border: 1px solid #ccc; padding: 15px;"></textarea>
        </div>
        <div id="data-management" class="content-section">
        <h3 class="section-title">ğŸ’¾ Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØªØ±</h3>
        <p>ÙŠÙ…ÙƒÙ†Ùƒ Ù‡Ù†Ø§ ØªØµØ¯ÙŠØ± Ø£Ùˆ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ (Ø§Ù„Ø·Ù„Ø§Ø¨ØŒ Ø§Ù„Ø­Ø¶ÙˆØ±ØŒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©ØŒ Ø§Ù„ØªÙ†Ù‚ÙŠØ· ...).</p>
        <button onclick="exportAllData()" class="btn btn-export">â¬‡ï¸ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <br><br>
        <input type="file" id="import-json" accept=".json" style="margin-top:10px;">
        <button onclick="importAllData()" class="btn btn-add">â¬†ï¸ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <div id="data-status" class="status-message"></div>
    </div>
</div>
</div>

<!-- Modals and Print Containers -->
<div id="qr-modal" class="modal"><div class="modal-content"><span class="close-btn" onclick="closeQrModal()">Ã—</span><h4>Ø±Ù…Ø² QR</h4><div id="qrcode-container"></div><div id="modal-student-info"></div></div></div>
<div id="print-qr-container"></div>

<script>
    // === SCRIPT FOR NOTEBOOK NAVIGATION ===
    function showSection(sectionId) {
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        document.getElementById(sectionId)?.classList.add('active');
        document.querySelectorAll('.sidebar ul li').forEach(li => {
            li.classList.toggle('active', li.getAttribute('onclick') === `showSection('${sectionId}')`);
        });
        if (sectionId !== 'attendance-system' && window.stopQrScanner) {
            window.stopQrScanner();
        }
    }

    // === DYNAMIC TABLE SCRIPT ===
    function addRow(tbodyId) {
        const tbody = document.getElementById(tbodyId);
        if (!tbody) return;
        const templateRow = tbody.querySelector('tr');
        if (!templateRow) return; 
        const newRow = templateRow.cloneNode(true);
        newRow.querySelectorAll('input, textarea').forEach(input => {
            input.value = (input.type === 'number') ? '' : '';
        });
        tbody.appendChild(newRow);
        if (tbodyId === 'grading-tbody') {
            renumberGradingTable(tbodyId);
        }
    }

    function deleteRow(button, tbodyId = null) {
        const row = button.closest('tr');
        if (row.parentElement.rows.length > 1) {
            row.remove();
        } else {
            row.querySelectorAll('input, textarea').forEach(input => {
                input.value = (input.type === 'number') ? '' : '';
            });
        }
        if (tbodyId === 'grading-tbody') {
            renumberGradingTable(tbodyId);
        }
    }

    function renumberGradingTable(tbodyId) {
        const tbody = document.getElementById(tbodyId);
        tbody.querySelectorAll('tr').forEach((row, index) => {
            const firstCell = row.querySelector('td');
            if (firstCell) firstCell.textContent = String(index + 1).padStart(2, '0');
        });
    }

    function addSeat(containerId) {
        const grid = document.getElementById(containerId);
        const newSeat = document.createElement('div');
        newSeat.className = 'seat';
        newSeat.innerHTML = `<input type="text" class="notebook-input"><button class="btn-delete-seat" onclick="deleteSeat(this)">Ã—</button>`;
        grid.appendChild(newSeat);
    }
    
    function deleteSeat(button) {
        const seat = button.closest('.seat');
        if (seat.parentElement.children.length > 1) {
            seat.remove();
        } else {
            seat.querySelector('input').value = '';
        }
    }

    // === INITIALIZE PAGE AND ATTENDANCE SYSTEM ===
    document.addEventListener('DOMContentLoaded', () => {
        showSection('welcome-page');
        
        // --- Attendance System ---
        function initializeAttendanceSystem() {
            const managementView = document.getElementById('management-view');
            const reportView = document.getElementById('report-view');
            const addStudentForm = document.getElementById('add-student-form');
            const firstNameInput = document.getElementById('first-name');
            const lastNameInput = document.getElementById('last-name');
            const studentIdInput = document.getElementById('student-id');
            const classNameInput = document.getElementById('class-name');
            const addStudentStatus = document.getElementById('add-student-status');
            const importFileInput = document.getElementById('import-file');
            const importStudentsBtn = document.getElementById('import-students-btn');
            const importStatus = document.getElementById('import-status');
            const studentListBody = document.getElementById('student-list-body');
            const totalStudentsCountEl = document.getElementById('total-students-count');
            const exportStudentsCsvBtn = document.getElementById('export-students-csv-btn');
            const startScanBtn = document.getElementById('start-scan-btn');
            const stopScanBtn = document.getElementById('stop-scan-btn');
            const qrReaderElement = document.getElementById('qr-reader');
            const qrScanStatus = document.getElementById('qr-scan-status');
            const goToReportBtn = document.getElementById('go-to-report-btn');
            const reportDateInput = document.getElementById('report-date');
            const refreshReportBtn = document.getElementById('refresh-report-btn');
            const backToManagementBtn = document.getElementById('back-to-management-btn');
            const attendancePercentageEl = document.getElementById('attendance-percentage');
            const presentCountEl = document.getElementById('present-count');
            const absentCountEl = document.getElementById('absent-count');
            const presentListBody = document.getElementById('present-list-body');
            const absentListBody = document.getElementById('absent-list-body');
            const exportReportCsvBtn = document.getElementById('export-report-csv-btn');
            const qrModal = document.getElementById('qr-modal');
            const qrcodeContainer = document.getElementById('qrcode-container');
            const modalStudentInfo = document.getElementById('modal-student-info');
            const printQrCardsBtn = document.getElementById('print-qr-cards-btn');
            const printQrContainer = document.getElementById('print-qr-container');
            let students = JSON.parse(localStorage.getItem('students')) || [];
            let html5QrCodeScanner = null;
            let liveAttendance = {};
            const saveStudents = () => localStorage.setItem('students', JSON.stringify(students));
            const getCurrentDateString = () => new Date().toISOString().split('T')[0];
            const getCurrentTimeString = () => new Date().toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });

            function showStatusMessage(element, message, type = 'info', duration = 5000) {
                element.textContent = message;
                element.className = `status-message ${type}`;
                if (duration > 0) {
                    setTimeout(() => { if (element.textContent === message) { element.textContent = ''; element.className = 'status-message'; }}, duration);
                }
            }
            
            function renderStudentList() {
                studentListBody.innerHTML = '';
                totalStudentsCountEl.textContent = students.length;
                const hasStudents = students.length > 0;
                exportStudentsCsvBtn.disabled = !hasStudents;
                printQrCardsBtn.disabled = !hasStudents;
                if (!hasStudents) {
                    studentListBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ø·Ù„Ø§Ø¨.</td></tr>';
                    return;
                }
                students.sort((a, b) => (a.firstName + " " + a.lastName).localeCompare(b.firstName + " " + b.lastName));
                students.forEach((student, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td>${student.id}</td><td>${student.firstName}</td><td>${student.lastName}</td><td>${student.className}</td><td><button class="btn btn-action btn-small show-qr-btn" data-index="${index}"><i class="fas fa-qrcode"></i></button> <button class="btn btn-delete btn-small" data-index="${index}"><i class="fas fa-trash-alt"></i></button></td>`;
                    studentListBody.appendChild(row);
                });
            }

            function showQrCode(index) {
                const student = students[index];
                if (!student) return;
                modalStudentInfo.textContent = `Ø§Ù„Ø·Ø§Ù„Ø¨: ${student.firstName} ${student.lastName}`;
                qrcodeContainer.innerHTML = '';
                try { new QRCode(qrcodeContainer, { text: student.id, width: 256, height: 256 }); qrModal.style.display = "block"; } catch (e) { console.error(e); }
            }
            window.closeQrModal = () => qrModal.style.display = "none";
            window.onclick = (event) => { if (event.target == qrModal) closeQrModal(); };

            addStudentForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const id = studentIdInput.value.trim();
                if (students.some(s => s.id === id)) { showStatusMessage(addStudentStatus, `Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ ${id} Ù…Ø³ØªØ®Ø¯Ù….`, 'error'); return; }
                students.push({ id, firstName: firstNameInput.value.trim(), lastName: lastNameInput.value.trim(), className: classNameInput.value.trim() });
                saveStudents(); renderStudentList(); showStatusMessage(addStudentStatus, 'ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­.', 'success'); addStudentForm.reset();
            });

            studentListBody.addEventListener('click', (e) => {
                const btn = e.target.closest('button');
                if (!btn) return;
                const index = btn.dataset.index;
                if (btn.classList.contains('show-qr-btn')) showQrCode(index);
                if (btn.classList.contains('btn-delete')) {
                    if (confirm(`ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ ${students[index].firstName}?`)) {
                        students.splice(index, 1);
                        saveStudents(); renderStudentList();
                    }
                }
            });
            
            importStudentsBtn.addEventListener('click', () => {
                const file = importFileInput.files[0];
                if (!file) { showStatusMessage(importStatus, "Ø§Ø®ØªØ± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹.", 'error'); return; }
                const reader = new FileReader();
                reader.onload = (event) => {
                    let parsedData;
                    if (file.name.endsWith('.csv')) { parsedData = Papa.parse(event.target.result, { header: true, skipEmptyLines: true }).data; } 
                    else { const workbook = XLSX.read(event.target.result, { type: 'array' }); parsedData = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]); }
                    processImportedData(parsedData);
                };
                if (file.name.endsWith('.csv')) reader.readAsText(file); else reader.readAsArrayBuffer(file);
            });

            function processImportedData(data) {
                let importedCount = 0, skippedCount = 0;
                data.forEach(row => {
                    const keys = Object.keys(row);
                    const id = String(row[keys[0]] || '').trim();
                    const firstName = String(row[keys[1]] || '').trim();
                    const lastName = String(row[keys[2]] || '').trim();
                    const className = String(row[keys[3]] || '').trim();
                    if(id && firstName && !students.some(s => s.id === id)) { students.push({ id, firstName, lastName, className }); importedCount++; } else { skippedCount++; }
                });
                saveStudents(); renderStudentList(); showStatusMessage(importStatus, `ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${importedCount} Ø·Ø§Ù„Ø¨ ÙˆØªØ®Ø·ÙŠ ${skippedCount}.`, 'success');
            }

            function onScanSuccess(decodedText) {
                const student = students.find(s => s.id === decodedText.trim());
                if (student) {
                    const time = getCurrentTimeString();
                    if (!liveAttendance[student.id]) { liveAttendance[student.id] = time; showStatusMessage(qrScanStatus, `ØªÙ… ØªØ³Ø¬ÙŠÙ„: ${student.firstName} ÙÙŠ ${time}`, 'success'); if(reportView.classList.contains('active-view')) generateAndDisplayReport(); } 
                    else { showStatusMessage(qrScanStatus, `${student.firstName} Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„.`, 'info'); }
                } else { showStatusMessage(qrScanStatus, `Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ ${decodedText} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.`, 'error'); }
            }

            function startQrScanner() {
                startScanBtn.style.display = 'none'; stopScanBtn.style.display = 'inline-flex'; qrReaderElement.style.display = 'block'; showStatusMessage(qrScanStatus, 'Ø¬Ø§Ø±ÙŠ ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...', 'info', 0);
                try { html5QrCodeScanner = new Html5Qrcode("qr-reader"); html5QrCodeScanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, onScanSuccess, (e)=>{}); } catch(e) { console.error(e); }
            }
            window.stopQrScanner = function() { if (html5QrCodeScanner && html5QrCodeScanner.isScanning) { html5QrCodeScanner.stop(); startScanBtn.style.display = 'inline-flex'; stopScanBtn.style.display = 'none'; qrReaderElement.style.display = 'none'; showStatusMessage(qrScanStatus, 'ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø§Ø³Ø­.', 'info'); }};
            startScanBtn.addEventListener('click', startQrScanner);
            stopScanBtn.addEventListener('click', window.stopQrScanner);

            function generateAndDisplayReport() {
                if (!reportDateInput.value) return; let presentCount = 0, absentCount = 0; presentListBody.innerHTML = ''; absentListBody.innerHTML = '';
                students.forEach(student => {
                    const time = liveAttendance[student.id];
                    if (time) { presentListBody.innerHTML += `<tr><td>${student.firstName} ${student.lastName}</td><td>${student.className}</td><td>${time}</td></tr>`; presentCount++; } 
                    else { absentListBody.innerHTML += `<tr><td>${student.firstName} ${student.lastName}</td><td>${student.className}</td></tr>`; absentCount++; }
                });
                const total = students.length;
                attendancePercentageEl.textContent = total > 0 ? `${((presentCount / total) * 100).toFixed(1)}%` : '0%';
                presentCountEl.textContent = presentCount; absentCountEl.textContent = absentCount; exportReportCsvBtn.disabled = total === 0;
            }

            const switchView = (viewToShow) => { document.querySelectorAll('#attendance-system .view').forEach(v => v.classList.remove('active-view')); viewToShow.classList.add('active-view'); };
            goToReportBtn.addEventListener('click', () => { reportDateInput.value = getCurrentDateString(); generateAndDisplayReport(); switchView(reportView); });
            backToManagementBtn.addEventListener('click', () => switchView(managementView));
            refreshReportBtn.addEventListener('click', generateAndDisplayReport);
            
            function exportToCsv(filename, rows) {
                const csvContent = "data:text/csv;charset=utf-8,\uFEFF" + rows.map(r => r.join(",")).join("\n");
                const link = document.createElement("a");
                link.setAttribute("href", encodeURI(csvContent)); link.setAttribute("download", filename);
                document.body.appendChild(link); link.click(); document.body.removeChild(link);
            }
            exportStudentsCsvBtn.addEventListener('click', () => { exportToCsv(`students.csv`, [["ID", "FirstName", "LastName", "Class"], ...students.map(s => [s.id, s.firstName, s.lastName, s.className])]); });
            exportReportCsvBtn.addEventListener('click', () => { const rows = [["ID", "Name", "Class", "Status", "Time"]]; students.forEach(s => { const time = liveAttendance[s.id]; rows.push([s.id, `${s.firstName} ${s.lastName}`, s.className, time ? 'Present' : 'Absent', time || '']); }); exportToCsv(`attendance_${reportDateInput.value}.csv`, rows); });

            printQrCardsBtn.addEventListener('click', () => {
                printQrContainer.innerHTML = ''; let currentPage = document.createElement('div'); currentPage.className = 'print-page'; printQrContainer.appendChild(currentPage);
                students.forEach((student, index) => {
                    if (index > 0 && index % 10 === 0) { currentPage = document.createElement('div'); currentPage.className = 'print-page'; printQrContainer.appendChild(currentPage); }
                    const card = document.createElement('div'); card.className = 'qr-card'; const qrDiv = document.createElement('div'); const infoDiv = document.createElement('div');
                    infoDiv.innerHTML = `<p><strong>${student.firstName} ${student.lastName}</strong></p><p>ID: ${student.id}</p>`;
                    card.append(qrDiv, infoDiv); currentPage.appendChild(card); new QRCode(qrDiv, { text: student.id, width: 120, height: 120 });
                });
                setTimeout(() => window.print(), 500);
            });
            renderStudentList();
        }
        initializeAttendanceSystem();
    });

// === EXPORT & IMPORT ALL DATA ===
function exportAllData() {
    const allData = {
        students: JSON.parse(localStorage.getItem('students')) || [],
        dailyNotes: JSON.parse(localStorage.getItem('dailyNotes')) || [],
        grading: JSON.parse(localStorage.getItem('grading')) || [],
        diary: JSON.parse(localStorage.getItem('diary')) || [],
        seating: JSON.parse(localStorage.getItem('seating')) || [],
        teachers: JSON.parse(localStorage.getItem('teachers')) || [],
        attendance: JSON.parse(localStorage.getItem('attendance')) || {}
    };
    const blob = new Blob([JSON.stringify(allData, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "notebook-data.json";
    a.click();
    URL.revokeObjectURL(url);
    document.getElementById("data-status").textContent = "âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­";
    document.getElementById("data-status").className = "status-message success";
}

function importAllData() {
    const fileInput = document.getElementById("import-json");
    const file = fileInput.files[0];
    if (!file) {
        document.getElementById("data-status").textContent = "âš ï¸ Ø§Ø®ØªØ± Ù…Ù„Ù JSON Ø£ÙˆÙ„Ø§";
        document.getElementById("data-status").className = "status-message error";
        return;
    }
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const data = JSON.parse(e.target.result);
            if (data.students) localStorage.setItem("students", JSON.stringify(data.students));
            if (data.dailyNotes) localStorage.setItem("dailyNotes", JSON.stringify(data.dailyNotes));
            if (data.grading) localStorage.setItem("grading", JSON.stringify(data.grading));
            if (data.diary) localStorage.setItem("diary", JSON.stringify(data.diary));
            if (data.seating) localStorage.setItem("seating", JSON.stringify(data.seating));
            if (data.teachers) localStorage.setItem("teachers", JSON.stringify(data.teachers));
            if (data.attendance) localStorage.setItem("attendance", JSON.stringify(data.attendance));
            document.getElementById("data-status").textContent = "âœ… ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„Ø¹Ø±Ø¶Ù‡Ø§.";
            document.getElementById("data-status").className = "status-message success";
        } catch (err) {
            document.getElementById("data-status").textContent = "âŒ Ø®Ø·Ø£: Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­";
            document.getElementById("data-status").className = "status-message error";
        }
    };
    reader.readAsText(file);
}

</script>

</body>
</html>